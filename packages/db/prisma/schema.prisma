
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String      @id       @default(uuid())
  email              String      @unique
  role               Role
  leaderboard        Leaderboard[]
  submissions        Submissions[]
  ContestSubmission  ContestSubmission[]
}

enum Role {
  User
  Admin
}

model Contest {
    id                           String     @id     @default(uuid())
    title                        String
    startTime                    DateTime  
    contestToChallengeMapping    ContestToChallengeMapping[] 
    leaderboard          Leaderboard[]
}

model ContestToChallengeMapping {
  id                   String       @id       @default(uuid())
  contestId            String
  challengeId          String
  index                Int
  ContestSubmission    ContestSubmission[]
  cosntest            Contest     @relation(fields: [contestId], references: [id])
  challenge           Challenge   @relation(fields: [challengeId], references: [id])
  @@unique([contestId, challengeId])
}


model Challenge {
    id                                String    @id    @default(uuid())
    title                             String    
    notionDocId                       String
    contestId                         String
    maxPoints                         Int
    contestToChallengeMapping         ContestToChallengeMapping[]
    submission                        Submissions[]
}

model ContestSubmission {
  id                              String        @id       @default(uuid())
  submission                      String
  contestToChallengeMappingId     String
  userId                          String
  points                          Int
  user                            User       @relation(fields: [userId], references: [id])
  contestToChallengeMapping       ContestToChallengeMapping @relation(fields: [contestToChallengeMappingId], references: [id])
}


model Submissions {
  id                             String     @id     @default(uuid())
  submission                     String      
  challengeId                    String
  ContestToChallengeMapping      String
  userId                         String
  user                           User           @relation(fields: [userId], references: [id]) 
  points                         Int
  challenge                      Challenge      @relation(fields: [challengeId], references: [id])
  createAt                       DateTime       @default(now())
}


model Leaderboard {
  id             String     @id     @default(uuid())
  constestId     String 
  userId         String
  rank           Int
  contest        Contest    @relation(fields: [constestId], references: [id])
  user           User       @relation(fields: [userId], references: [id])
  
  @@unique([constestId, rank])

}
